<!DOCTYPE html>
<html lang="fr">
<head>
  <!--
    PowerPoint Generator Pro - v2.1
    
    Corrections v2.1:
    1. ✅ Système d'avertissements pour contenu long (titres >50 car, bullets >12 mots, tables >5 cols/8 rows)
    2. ✅ Dimensions adaptatives pour tables (largeur et hauteur calculées selon contenu)
    3. ✅ Ajustement automatique de la taille de police selon longueur du texte
    4. ✅ Limitation automatique à 4 bullets maximum par slide (évite débordement)
    5. ✅ Wrapping activé pour cellules de tableau
    6. ✅ Hauteur et largeur de colonnes/rangées calculées dynamiquement
    
    Ces corrections résolvent les problèmes:
    - Contenu sortant du cadre des slides
    - Tables avec trop de colonnes/rangées
    - Texte trop long dans les cellules
  -->
  
  <!-- Content Security Policy pour sécurité maximale -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'none'; script-src 'self'; style-src 'self'; img-src 'self' data:; font-src 'self' data:; connect-src 'none'; frame-ancestors 'none'; base-uri 'self'; form-action 'self';">
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Générateur de présentations PowerPoint professionnel avec IA">
  <title>PowerPoint Generator Pro - v2.1</title>
  
  <!-- Chargement LOCAL de PptxGenJS -->
  <script src="./pptxgen.bundle.js" defer></script>

  <link rel="stylesheet" href="src/css/app.css">

</head>
<body>
  <div class="header">
    <div class="logo">
      <div class="logo-icon" role="img" aria-label="PowerPoint Generator Pro Logo">PP</div>
      <h1>PowerPoint Generator Pro</h1>
    </div>
    <div class="subtitle">Solution professionnelle améliorée de génération de présentations - v2.1 (Anti-débordement)
    <div class="security-badge">
      <span role="img" aria-label="Lock">🔒</span>
      <span>100% Offline & Sécurisé</span>
    </div>
  </div>

  <div class="container">
    <!-- Barre d'action principale -->
    <div class="action-bar">
      <div class="action-info">
        <div class="status-indicator" role="status" aria-live="polite">
          <span class="status-dot" id="statusDot" aria-hidden="true"></span>
          <span id="statusText">Vérification...</span>
        </div>
        <div class="validation-status" id="validationStatus" role="status" aria-live="polite">
          <span id="validationText"></span>
        </div>
      </div>
      <div class="action-buttons">
        <button
          class="btn btn-secondary"
          id="templatesBtn"
          aria-label="Charger un template pré-défini">
          📄 Templates
        </button>
        <button
          class="btn btn-secondary"
          id="historyBtn"
          aria-label="Voir l'historique des générations">
          📜 Historique
        </button>
        <button
          class="btn-generate-main"
          id="generateBtn"
          aria-label="Générer la présentation PowerPoint"
          disabled>
          <span class="btn-icon" aria-hidden="true">▶</span>
          <span>Générer PowerPoint</span>
        </button>
      </div>
    </div>
    
    <div class="layout">
      <!-- Panel Prompt -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">
            <span class="panel-badge" aria-hidden="true">1</span>
            Prompt Template IA
          </span>
          <button
            class="btn btn-primary"
            id="copyPromptBtn"
            aria-label="Copier le prompt template dans le presse-papiers">
            📋 Copier le prompt
          </button>
        </div>
        <div class="panel-content">
          <div 
            class="prompt-content" 
            id="prompt"
            role="region"
            aria-label="Prompt template pour l'IA">Tu es un générateur de contenu pour présentations PowerPoint professionnelles.
Tu dois produire UNIQUEMENT un objet JSON valide, sans texte avant/après, sans balises markdown, sans commentaires.

════════════════════════════════════════════════════════════════════════════════
CONTEXTE À DÉFINIR
════════════════════════════════════════════════════════════════════════════════

SUJET : [votre sujet]
NOMBRE_SLIDES : [nombre ou AUTO]
STYLE : [professionnel|créatif|académique|commercial]

════════════════════════════════════════════════════════════════════════════════
RÈGLES ABSOLUES
════════════════════════════════════════════════════════════════════════════════

✅ JSON STRICT :
• UTF-8, guillemets doubles uniquement
• Échapper guillemets internes avec \"
• Pas de virgules finales, pas de commentaires
• Nombres dans tableaux = chaînes ("45%", "2.5M€")
• Nombres dans graphiques = nombres purs (45, 2.5)

✅ CONTRAINTES :
• Titres : max 60 caractères
• Bullets : 3-5 par slide, max 15 mots
• Tables : max 4 colonnes × 10 lignes
• Première slide = type "title"
• Dernière slide = type "content" avec call-to-action

════════════════════════════════════════════════════════════════════════════════
STRUCTURE JSON
════════════════════════════════════════════════════════════════════════════════

{
  "metadata": {
    "title": "Titre de la présentation",
    "fileName": "nom-fichier.pptx",
    "author": "Auteur",
    "expectedSlideCount": 10
  },
  "slides": [
    {
      "type": "title",
      "title": "Titre principal",
      "subtitle": "Sous-titre"
    },
    {
      "type": "content", 
      "title": "Titre de slide",
      "bullets": [
        "Point 1 (max 15 mots)",
        "Point 2",
        "Point 3"
      ]
    },
    {
      "type": "twoColumn",
      "title": "Titre",
      "leftContent": ["Point 1", "Point 2"],
      "rightContent": ["Point 1", "Point 2"]
    },
    {
      "type": "table",
      "title": "Titre",
      "tableData": [
        ["En-tête 1", "En-tête 2", "En-tête 3"],
        ["Donnée", "45%", "2.5M€"]
      ]
    },
    {
      "type": "chart",
      "title": "Titre",
      "chartType": "bar",
      "data": [
        { "label": "Q1", "value": 45 },
        { "label": "Q2", "value": 52 },
        { "label": "Q3", "value": 48 }
      ]
    },
    {
      "type": "image",
      "title": "Titre",
      "imagePath": "IMAGE_PLACEHOLDER_description"
    }
  ]
}

════════════════════════════════════════════════════════════════════════════════
TYPES DISPONIBLES
════════════════════════════════════════════════════════════════════════════════

• title : Slide d'ouverture
• content : Contenu avec bullets  
• twoColumn : Deux colonnes
• table : Tableau de données
• chart : Graphique (bar, line, pie)
• image : Image ou placeholder

════════════════════════════════════════════════════════════════════════════════

GÉNÈRE UNIQUEMENT LE JSON, SANS TEXTE AVANT/APRÈS.</div>
        </div>
      </div>

      <!-- Panel JSON -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">
            <span class="panel-badge" aria-hidden="true">2</span>
            JSON de l'IA
          </span>
          <div class="panel-actions">
            <button
              class="btn"
              id="clearJsonBtn"
              aria-label="Effacer le contenu JSON">
              🗑️ Effacer
            </button>
            <button
              class="btn btn-success"
              id="importJsonBtn"
              aria-label="Importer un fichier JSON">
              📂 Importer
            </button>
            <button
              class="btn btn-success"
              id="exportJsonBtn"
              aria-label="Exporter le JSON vers un fichier">
              💾 Exporter
            </button>
          </div>
        </div>
        <div class="panel-content">
          <textarea 
            id="jsonInput" 
            placeholder="Collez ici le JSON généré par l'IA...

Exemple:
{
  &quot;metadata&quot;: {
    &quot;title&quot;: &quot;Ma Présentation&quot;,
    &quot;fileName&quot;: &quot;presentation.pptx&quot;,
    &quot;expectedSlideCount&quot;: 5
  },
  &quot;slides&quot;: [...]
}"
            spellcheck="false"
            aria-label="Zone de saisie pour le JSON de l'IA"
            aria-describedby="validationErrors"
          ></textarea>
          <div class="validation-errors" id="validationErrors" role="alert"></div>
        </div>
      </div>
    </div>

    <!-- Instructions -->
    <div class="instructions">
      <div class="instructions-title">Mode d'emploi</div>
      <div class="instructions-grid">
        <div class="instruction-item">
          <div class="instruction-number" aria-hidden="true">1</div>
          <div class="instruction-text">
            Copiez le prompt template et collez-le dans votre IA (ChatGPT, Claude, etc.)
          </div>
        </div>
        <div class="instruction-item">
          <div class="instruction-number" aria-hidden="true">2</div>
          <div class="instruction-text">
            Personnalisez le contexte (sujet, nombre de slides, style) dans le prompt
          </div>
        </div>
        <div class="instruction-item">
          <div class="instruction-number" aria-hidden="true">3</div>
          <div class="instruction-text">
            Copiez le JSON généré par l'IA et collez-le dans le panel de droite
          </div>
        </div>
        <div class="instruction-item">
          <div class="instruction-number" aria-hidden="true">4</div>
          <div class="instruction-text">
            La validation en temps réel vous indiquera les erreurs éventuelles
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast notification -->
  <div class="toast" id="toast" role="alert" aria-live="assertive"></div>

  <!-- Templates Modal -->
  <div class="modal" id="templatesModal" role="dialog" aria-labelledby="templatesModalTitle" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="templatesModalTitle">Templates Pré-définis</h2>
        <button class="modal-close" id="closeTemplatesBtn" aria-label="Fermer la fenêtre">×</button>
      </div>
      <div class="modal-body">
        <p class="modal-description">
          Choisissez un template pour démarrer rapidement
        </p>
        <div class="template-grid" id="templateGrid"></div>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div class="modal" id="historyModal" role="dialog" aria-labelledby="historyModalTitle" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="historyModalTitle">Historique des Générations</h2>
        <button class="modal-close" id="closeHistoryBtn" aria-label="Fermer la fenêtre">×</button>
      </div>
      <div class="modal-body">
        <div class="history-list" id="historyList"></div>
      </div>
    </div>
  </div>

  <!-- Hidden file input for import -->
  <input type="file" id="fileInput" class="hidden-file-input" accept=".json">

  <script src="src/js/validator.js" defer></script>
  <script src="src/js/app.js" defer></script>
</body>
</html>
